# finalproject_Lukashov_dpo_nod

## Общая информация

Проект представляет собой консольное приложение для управления валютным портфелем.  
Поддерживается регистрация и авторизация пользователей, операции покупки и продажи валют, просмотр портфеля, работа с локальным кешем курсов и обновление курсов через сервис парсинга.

Приложение построено с разделением на:
- CLI (интерфейс командной строки)
- Core Service (бизнес-логика)
- Parser Service (обновление курсов валют)

---

## Управление пользователями и портфелями (Core Service)

Core Service отвечает за бизнес-логику приложения и работу с локальными JSON-файлами.

### Возможности

- регистрация пользователей
- авторизация пользователей
- хранение пользователей в `users.json`
- автоматическое создание портфеля
- хранение портфелей в `portfolios.json`
- управление кошельками и балансами
- покупка и продажа валют
- расчёт стоимости портфеля в базовой валюте
- работа с локальным кешем курсов

---

## Пользователи

Для каждого пользователя хранится следующая информация:
- `user_id`
- `username`
- `hashed_password`
- `salt`
- `registration_date`

Пароли хранятся в хэшированном виде с использованием SHA-256 и соли.

---

## Портфель и кошельки

- каждому пользователю соответствует один портфель
- кошелёк создаётся автоматически при первой покупке валюты
- баланс кошелька не может быть отрицательным

---

## Работа с валютами

### Покупка валюты
- проверяется корректность валютного кода
- сумма операции должна быть положительной
- используется актуальный курс из локального кеша
- операция логируется

### Продажа валюты
- проверяется наличие кошелька
- проверяется достаточность средств
- операция логируется

---

## Курсы валют

Core Service использует локальный кеш `rates.json`.

Для каждого курса хранится:
- значение курса
- время последнего обновления
- источник данных

Для кеша применяется TTL.

---

## Сервис парсинга курсов (Parser Service)

Parser Service отвечает за получение и обновление курсов валют из внешних источников.

### Источники данных
- CoinGecko — криптовалюты
- ExchangeRate-API — фиатные валюты

### Компоненты
- `config.py` — конфигурация API и параметров
- `api_clients.py` — клиенты внешних API
- `updater.py` — координация обновления курсов
- `storage.py` — атомарная запись файлов
- `scheduler.py` — задел под планировщик

Parser Service отказоустойчив: сбой одного источника не останавливает обновление.

---

## CLI — команды приложения

### Пользователи
- `register --username <str> --password <str>` — регистрация пользователя
- `login --username <str> --password <str>` — авторизация пользователя

### Портфель
- `show-portfolio [--base <CODE>]` — показать портфель пользователя

### Валютные операции
- `buy --currency <CODE> --amount <float>` — покупка валюты
- `sell --currency <CODE> --amount <float>` — продажа валюты

### Курсы валют
- `get-rate --from <CODE> --to <CODE>` — получить курс валюты
- `show-rates [--currency <CODE>] [--top <N>] [--base <CODE>]` — показать курсы из локального кеша
- `update-rates [--source coingecko|exchangerate]` — обновить курсы валют

### Общие команды
- `exit` — выход из программы

---

## Логирование и обработка ошибок

- используется файловое логирование с ротацией
- логируются операции пользователей и обновление курсов
- используются пользовательские исключения:
  - `CurrencyNotFoundError`
  - `InsufficientFundsError`
  - `ApiRequestError`

Ошибки корректно обрабатываются и не приводят к падению приложения.

---

## Качество кода

- модульная архитектура
- использование Singleton для конфигурации и БД
- декораторы для логирования
- статический анализ кода (`ruff`)
- расширяемая структура проекта


## Демонстрация игрового процесса
[![asciinema](https://asciinema.org/a/46fNfTfUcaxMTMda.svg)](https://asciinema.org/a/46fNfTfUcaxMTMda)
